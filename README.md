# 🥜 Peanut Pod - 代理池管理工具

<div align="center">

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![Flet](https://img.shields.io/badge/Flet-0.23+-purple.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

一个现代化的代理池管理工具，支持代理测试、自动轮换、本地代理服务器等功能。

[功能特性](#-功能特性) • [快速开始](#-快速开始) • [使用说明](#-使用说明) • [截图展示](#-截图展示)

</div>

---

## ✨ 功能特性

### 🔍 代理管理
- **批量导入**：支持从 TXT 文件批量导入代理
- **智能测试**：50 并发异步测试，快速验证代理可用性
- **自动清理**：失败 5 次的代理自动删除，保持代理池质量
- **多维度评分**：基于延迟、匿名度、速度的综合评分系统

### 📊 数据展示
- **实时筛选**：按国家、状态、延迟筛选代理
- **动态统计**：实时显示各类代理数量
- **进度追踪**：测试进度条实时显示
- **详细信息**：延迟、速度、匿名度、地理位置等完整信息

### 🔄 代理服务
- **本地服务器**：内置 SOCKS5 代理服务器（127.0.0.1:1080）
- **单层/多层代理**：支持单层和多层代理链路
- **IP 轮换**：自动定时切换代理 IP（仅单层模式）
- **动态切换**：运行时无缝切换上游代理

### 📤 数据导出
- **Excel 导出**：一键导出代理列表到 Excel
- **完整数据**：包含所有测试结果和统计信息

### 🎨 现代化 UI
- **紫色主题**：精心设计的紫色系配色方案
- **流程可视化**：代理链路流程图展示
- **实时日志**：所有操作实时日志输出
- **响应式设计**：流畅的用户交互体验

---

## 🚀 快速开始

### 环境要求

- Python 3.8+
- pip 包管理器

### 安装依赖

```bash
pip install flet requests openpyxl pyyaml
```

### 运行程序

```bash
cd src
flet run main.py
```

或者直接运行：

```bash
python src/main.py
```

---

## 📖 使用说明

### 1. 导入代理

1. 准备一个 TXT 文件，每行一个代理地址，格式：
   ```
   socks5://127.0.0.1:1080
   http://192.168.1.1:8080
   ```

2. 点击 **"导入代理"** 按钮，选择文件

3. 程序会自动测试所有代理（50 并发）

### 2. 筛选代理

- **国家筛选**：下拉选择特定国家的代理
- **状态筛选**：筛选可用/不可用的代理
- **优质代理**：勾选仅显示延迟 < 2s 的代理

### 3. 启动代理服务

1. 点击左侧代理流程图中的 **"代理服务器"** 节点（变为紫色）
2. 在右侧表格中点击选择一个代理
3. 点击 **"启动"** 按钮
4. 本地代理服务器启动在 `127.0.0.1:1080`

### 4. IP 轮换（仅单层代理）

1. 确保处于单层代理模式
2. 设置轮换间隔（默认 10 秒）
3. 点击 **"启用轮换"** 按钮
4. 系统会自动循环切换可用代理

### 5. 切换代理模式

点击 **"代理链路"** 右侧的三点菜单：
- **单层代理**：公网 IP → 代理服务器 → Internet
- **多层代理**：公网 IP → 代理服务器(1) → 代理服务器(2) → Internet

### 6. 导出数据

1. 点击 **"更多操作"** 按钮
2. 选择 **"导出代理"**
3. 数据将导出到 `src/storage/data/` 目录

---

## 🎯 核心功能详解

### 代理测试机制

**三阶段测试流程**：

1. **连通性测试**（2秒超时）
   - 快速验证代理是否可用
   - 测量延迟时间

2. **详细信息获取**（并行执行）
   - 地理位置查询（国家、城市）
   - 匿名度检测（高匿/普匿/透明）

3. **速度测试**（仅低延迟代理）
   - 延迟 < 5s 的代理才进行速度测试
   - 测量下载速度（MB/s）

**评分系统**：
- 延迟分数（40%）：< 0.5s = 100分，< 1s = 80分，< 2s = 60分
- 匿名度分数（30%）：高匿 = 100分，普匿 = 70分，透明 = 40分
- 速度分数（30%）：≥ 50Mbps = 100分，≥ 10Mbps = 80分

### 失败计数机制

- 每个代理都有 `fail_count` 字段
- 测试可用时：`fail_count` 重置为 0
- 测试不可用时：`fail_count` +1
- `fail_count ≥ 5`：自动删除该代理

### 代理服务器

**技术实现**：
- 基于 Python socket 的 SOCKS5 服务器
- 支持上游代理（SOCKS5/HTTP/HTTPS）
- 支持运行时动态切换上游代理
- 多线程处理客户端连接

---

## 📁 项目结构

```
Peanut Pod/
├── src/
│   ├── main.py                 # 主程序入口
│   ├── assets/
│   │   └── pool.json          # 代理池数据
│   ├── script/
│   │   ├── Connectivity.py    # 代理测试模块
│   │   ├── server.py          # SOCKS5 服务器
│   │   └── export.py          # 数据导出模块
│   └── storage/
│       ├── data/              # 导出数据目录
│       └── temp/              # 临时文件目录
└── README.md
```

---

## 🎨 界面预览

### 主界面
- 左侧：代理链路流程图
- 右侧：代理列表表格
- 顶部：筛选选项和轮换控制
- 底部：日志输出和操作按钮

### 配色方案
- 主背景：`#1A0B2E` (深紫色)
- 导航栏：`#2D1B4E` (深紫)
- 表格/面板：`#2A1A3D` (中深紫)
- 强调色：`#CE93D8`, `#AB47BC` (浅紫)
- 节点边框：`#7E57C2` (紫色)

---

## 🔧 技术栈

- **UI 框架**：[Flet](https://flet.dev/) - 基于 Flutter 的 Python UI 框架
- **网络请求**：requests - HTTP 客户端库
- **并发处理**：ThreadPoolExecutor - 线程池并发
- **数据导出**：openpyxl - Excel 文件处理
- **代理协议**：SOCKS5, HTTP/HTTPS

---

## 📝 配置说明

### 代理格式

支持以下格式：
```
socks5://host:port
http://host:port
https://host:port
```

### 测试配置

在 `src/script/Connectivity.py` 中可调整：
- `max_workers`：并发数（默认 50）
- `timeout`：超时时间（默认 2-3 秒）
- 测试目标 URL

### 服务器配置

在 `src/script/server.py` 中可调整：
- 监听地址：默认 `127.0.0.1:1080`
- 缓冲区大小：默认 4096 字节

---

## ⚠️ 注意事项

1. **代理来源**：请确保代理来源合法，遵守相关法律法规
2. **测试频率**：大量并发测试可能被目标网站限制
3. **网络环境**：需要能够访问测试目标（百度、httpbin.org 等）
4. **资源占用**：50 并发测试会占用一定的网络和 CPU 资源

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 开发建议

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

---

## 🙏 致谢

- [Flet](https://flet.dev/) - 优秀的 Python UI 框架
- [httpbin.org](http://httpbin.org/) - HTTP 测试服务
- [ip-api.com](http://ip-api.com/) - IP 地理位置查询

---

## 📮 联系方式

如有问题或建议，欢迎通过以下方式联系：

- 提交 [Issue](../../issues)
- 发起 [Discussion](../../discussions)

---

<div align="center">

**⭐ 如果这个项目对你有帮助，请给个 Star！⭐**

Made with ❤️ by [Your Name]

</div>
